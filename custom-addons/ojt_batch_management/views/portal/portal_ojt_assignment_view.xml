<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ============================= -->
    <!-- OJT PORTAL ASSIGNMENT VIEW -->
    <!-- ============================= -->
    <template id="portal_ojt_assignment_view" name="OJT Portal Assignment View">
        <t t-call="portal.portal_layout">
            <div class="container mt-5 o_portal_my_assignment">
                <div class="mb-3">
                    <a href="/my/ojt/assignments" class="btn btn-secondary">
                        <i class="fa fa-arrow-left"></i> Back to Assignments
                    </a>
                </div>

                <t t-if="assignment">
                    <div class="row">
                        <div class="col-lg-8">
                            <!-- Assignment Details Card -->
                            <div class="card shadow-sm mb-4">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0"><t t-esc="assignment.name"/></h4>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <p><strong>Type:</strong>
                                                <span class="badge badge-info ml-2">
                                                    <t t-esc="assignment.type"/>
                                                </span>
                                            </p>
                                            <p><strong>Deadline:</strong>
                                                <span class="text-danger"><t t-esc="assignment.deadline"/></span>
                                            </p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Max Score:</strong> <t t-esc="assignment.max_score"/></p>
                                            <p><strong>Attachment Required:</strong>
                                                <i t-attf-class="fas fa-{{ assignment.attachment_required and 'check text-success' or 'times text-muted' }}"></i>
                                            </p>
                                        </div>
                                    </div>

                                    <t t-if="assignment.description">
                                        <div class="mt-3">
                                            <strong>Description:</strong>
                                            <div class="mt-2">
                                                <t t-raw="assignment.description"/>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <!-- Submission Section -->
                            <t t-if="submission">
                                <!-- Existing Submission Details -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">Your Submission</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <p><strong>Submitted On:</strong> <t t-esc="submission.submitted_on"/></p>
                                                <p><strong>Late:</strong>
                                                    <span t-attf-class="badge badge-{{ submission.late and 'warning' or 'success' }}">
                                                        <t t-esc="submission.late and 'Yes' or 'No'"/>
                                                    </span>
                                                </p>
                                                <p><strong>Status:</strong>
                                                    <span t-attf-class="badge badge-{{ submission.state == 'scored' and 'success' or submission.state == 'submitted' and 'info' or 'secondary' }}">
                                                        <t t-esc="submission.state"/>
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="col-md-6">
                                                <t t-if="submission.score">
                                                    <p><strong>Score:</strong> <t t-esc="submission.score"/>/<t t-esc="assignment.max_score"/></p>
                                                </t>
                                                <t t-if="submission.reviewer_id">
                                                    <p><strong>Reviewer:</strong> <t t-esc="submission.reviewer_id.name"/></p>
                                                </t>
                                            </div>
                                        </div>

                                        <t t-if="submission.url_link">
                                            <div class="mt-3">
                                                <strong>URL/Link:</strong>
                                                <a t-att="href" t-att-href="submission.url_link" target="_blank" class="ml-2">
                                                    <t t-esc="submission.url_link"/>
                                                    
                                                </a>
                                            </div>
                                        </t>

                                        <t t-if="submission.attachment_ids">
                                            <div class="mt-3">
                                                <strong>Attachments:</strong>
                                                <ul class="list-unstyled ml-3">
                                                    <t t-foreach="submission.attachment_ids" t-as="attachment">
                                                        <li>
                                                            <a t-att="href" t-att-href="attachment.url" target="_blank">
                                                                
                                                                <t t-esc="attachment.name"/>
                                                            </a>
                                                        </li>
                                                    </t>
                                                </ul>
                                            </div>
                                        </t>

                                        <t t-if="submission.feedback">
                                            <div class="mt-3">
                                                <strong>Feedback:</strong>
                                                <div class="alert alert-info mt-2">
                                                    <t t-raw="submission.feedback"/>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </t>

                            <t t-else="">
                                <!-- Submission Form -->
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header bg-warning text-white">
                                        <h5 class="mb-0">Submit Assignment</h5>
                                    </div>
                                    <div class="card-body">
                                        <form action="/my/ojt/assignment/submit" method="post" enctype="multipart/form-data">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <input type="hidden" name="assignment_id" t-att-value="assignment.id"/>

                                            <div class="form-group">
                                                <label for="url_link">URL/Link (Optional)</label>
                                                <input type="url" class="form-control" id="url_link" name="url_link"
                                                       placeholder="https://example.com"/>
                                                <small class="form-text text-muted">Provide a link to your submission if applicable.</small>
                                            </div>

                                            <div class="form-group">
                                                <label for="attachments">Attachments</label>
                                                <input type="file" class="form-control-file" id="attachments" name="attachment1"
                                                       multiple="multiple" t-att="required" t-att-required="assignment.attachment_required"/>
                                                <small class="form-text text-muted">
                                                    <t t-if="assignment.attachment_required">At least one attachment is required.</t>
                                                    <t t-else="">Attachments are optional.</t>
                                                </small>
                                            </div>

                                            <button type="submit" class="btn btn-primary">
                                                Submit Assignment
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </t>
                        </div>

                        <div class="col-lg-4">
                            <!-- Quick Info Sidebar -->
                            <div class="card shadow-sm mb-4">
                                <div class="card-header">
                                    <h6 class="mb-0">Assignment Info</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>Batch:</strong> <t t-esc="assignment.batch_id.name"/></p>
                                    <p><strong>State:</strong>
                                        <span t-attf-class="badge badge-{{ assignment.state == 'open' and 'success' or assignment.state == 'closed' and 'secondary' or 'warning' }}">
                                            <t t-esc="assignment.state"/>
                                        </span>
                                    </p>
                                    <p><strong>Weight:</strong> <t t-esc="assignment.weight"/></p>
                                </div>
                            </div>

                            <!-- Related Event -->
                            <t t-if="assignment.event_link_id">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-header">
                                        <h6 class="mb-0">Related Event</h6>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Event:</strong> <t t-esc="assignment.event_link_id.event_id.name"/></p>
                                        <p><strong>Date:</strong> <t t-esc="assignment.event_link_id.event_date"/></p>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Success/Error Messages -->
                    <t t-if="success == 'submitted'">
                        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
                            <strong>Success!</strong> Your assignment has been submitted successfully.
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&#215;</span>
                            </button>
                        </div>
                    </t>
                    <t t-if="error == 'already_submitted'">
                        <div class="alert alert-warning alert-dismissible fade show mt-3" role="alert">
                            <strong>Warning!</strong> You have already submitted this assignment.
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&#215;</span>
                            </button>
                        </div>
                    </t>
                    <t t-if="error == 'submit_failed'">
                        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
                            <strong>Error!</strong> Submission failed. Please try again.
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&#215;</span>
                            </button>
                        </div>
                    </t>
                </t>

                <t t-else="">
                    <div class="alert alert-warning">
                        <h4 class="alert-heading">Assignment Not Found</h4>
                        <p>The requested assignment could not be found.</p>
                    </div>
                </t>
            </div>
        </t>
    </template>
</odoo>
